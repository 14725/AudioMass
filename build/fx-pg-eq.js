(function(F,m,G){function D(){function l(a,b,c,f){var g=!1,e;for(e in c)if(b[e]!==c[e])if(g=!0,b[e]=c[e],"_on"===e){var d=document.getElementById("pgon"+b.id);d.checked=b[e]}else"freq"===e?(d=b.el.getElementsByClassName("pk_freq")[0],d.value=b[e]):"gain"===e?(d=b.el.getElementsByClassName("pk_gain")[0],d.value=b[e]):"q"===e?(d=b.el.getElementsByClassName("pk_q")[0],d.value=b[e]):"type"===e&&(d=b.el.getElementsByTagName("select")[0],"peaking"===b[e]?d.options[0].selected=!0:"lowpass"===b[e]?d.options[1].selected=
!0:"highpass"===b[e]&&(d.options[2].selected=!0),n(b),a.ranges.sort(h));g&&(f&&(f=a.ui.canvas_eq,c=f.width,f=f.height,b._coords.x=5E3>=b.freq?(b.freq/5E3*(c/2)).toFixed(1)/1:(c/2+(b.freq-5E3)/15E3*(c/2)).toFixed(1)/1,b._coords.y="peaking"===b.type?((1-(b.gain+35)/70)*f).toFixed(1)/1:(f/2).toFixed(1)/1),w&&clearTimeout(w),w=setTimeout(function(){a.Callback();w=null},38),a.Render())}function B(a){return a*a*a*a}function n(a){for(var b=[],c=0;c<r;++c)b[c]=0;a._arr=b;var f=2/a.q*C,g=f/u>>0;if("peaking"===
a.type){c=a.freq-f/2;var e=a.freq+f/2;f=c/u>>0;e=e/u>>0;var d=0;for(c=f;c<e;++c)c*u<a.freq?++d:--d,f=d/(g/2),b[c]+=f*f*f*f*f*a.gain}else if("highpass"===a.type){c=a.freq-f;f=c/u>>0;e=a.freq/u>>0;for(c=0;c<f;++c)b[c]=-35;d=g;for(c=f;c<e;++c)--d,b[c]-=35*B(d/g)}else if("lowpass"===a.type){e=a.freq+f;f=a.freq/u>>0;for(c=e=e/u>>0;c<r;++c)b[c]=-35;d=0;for(c=f;c<e;++c)++d,b[c]-=35*B(d/g)}}function z(a){var b=a.ui.canvas_eq,c=0,f=!1,g=function(c){if(f&&a.act){var d=b.getBoundingClientRect(),e=b.height,g=
c.clientX-d.left;c=c.clientY-d.top;d=g/b.width;a.act._coords.x=g;a.act._coords.y=c;g=.5>=d?1E4*d>>0:5E3+(3E4*(d-.5)>>0);e=(-70*(c/e-.5)).toFixed(2)/1;l(a,a.act,{freq:g,gain:e});n(a.act)}},e=function(a){f=!1;b.removeEventListener("mousemove",g);b.removeEventListener("mouseup",e)};b.addEventListener("mousedown",function(c){var d=!!a.act;if(0===a.ranges.length)d&&a.Render();else{var x=b.getBoundingClientRect(),k=c.clientX-x.left;c=c.clientY-x.top;for(x=0;x<a.ranges.length;++x){var t=a.ranges[x];if(10>
Math.abs(t._coords.x-k)&&9>Math.abs(t._coords.y-c)){d&&a.act.el.classList.remove("pk_act");a.act=t;a.act.el.classList.add("pk_act");f=!0;a.Render();b.addEventListener("mousemove",g,!1);b.addEventListener("mouseup",e,!1);return}}d&&(a.act.el.classList.remove("pk_act"),a.act=null,a.Render())}},!1);b.addEventListener("click",function(d){if(250>d.timeStamp-c){var f=b.getBoundingClientRect(),e=b.height,g=d.clientX-f.left;f=d.clientY-f.top;var t=g/b.width;t=.5>=t?1E4*t>>0:5E3+(3E4*(t-.5)>>0);e=(-70*(f/
e-.5)).toFixed(2)/1;a.Add("peaking",!0,t,e,5,g,f)}c=d.timeStamp},!1)}function y(a,b,c){var f=a.ui.el_list,g=m.createElement("div");g.className="pk_pgeq_els"+(c?c:"");g.setAttribute("data-id",b.id);g.addEventListener("click",function(c){b.el&&b!==a.act&&(a.act&&a.act.el.classList.remove("pk_act"),a.act=b,a.act.el.classList.add("pk_act"),a.Render())},!1);g.addEventListener("mouseover",function(c){b.el&&!b._hov&&(b._hov=!0,a.Render())},!1);g.addEventListener("mouseleave",function(c){b.el&&b._hov&&(b._hov=
!1,a.Render())},!1);c=b._on?"checked":"";var e="<i>"+b.id+"</i>",d=m.createElement("div");d.className="pk_txlft";d.innerHTML=e+'<input type="checkbox" id="pgon'+b.id+'" class="pk_check" name="onoff" '+c+'><label for="pgon'+b.id+'">ON</label>';d.getElementsByTagName("input")[0].onchange=function(c){l(a,b,{_on:!!this.checked});this.parentNode.getElementsByTagName("label")[0].innerHTML=this.checked?"ON":"OFF"};g.appendChild(d);c="lowpass"===b.type?"selected":"";e="highpass"===b.type?"selected":"";d=
m.createElement("div");d.innerHTML="<select><option>peaking</option><option "+c+">lowpass</option><option "+e+">highpass</option></select>";d.getElementsByTagName("select")[0].onchange=function(c){c=this.options[this.selectedIndex].value;"peaking"===c?g.classList.remove("pk_dis"):g.classList.add("pk_dis");l(a,b,{type:c},1)};g.appendChild(d);c=m.createElement("div");c.innerHTML='<input type="number" class="pk_val pk_gain" min="-35" max="35" value="'+b.gain+'">';c.getElementsByClassName("pk_gain")[0].onchange=
function(c){this.value||(this.value=0);this.hasAttribute("data-open")&&(this.parentNode.getElementsByClassName("pk_horiz")[0].value=this.value);l(a,b,{gain:this.value/1},1);n(b)};c.getElementsByClassName("pk_gain")[0].onfocus=function(c){if(!this.hasAttribute("data-open")){var d=this,f=this.parentNode,e=document.createElement("div");e.className="pk_pgeq_freq pk_gain";e.innerHTML='<div class="pk_arr"></div><input type="range" min="-35" max="35" class="pk_horiz pk_gain" step="0.1" value="'+b.gain+'">';
e.getElementsByClassName("pk_horiz")[0].oninput=function(a){d.value!=this.value&&(d.value=this.value,d.onchange())};f.appendChild(e);this.setAttribute("data-open","1");var g=function(b){if(!b.target.classList.contains("pk_gain")||b.target.type===d.type&&b.target!==d)d.removeAttribute("data-open"),f.removeChild(e),a.el.removeEventListener("mousedown",g)};a.el.addEventListener("mousedown",g,!1)}};g.appendChild(c);c=m.createElement("div");c.innerHTML='<input type="number" class="pk_val pk_freq" min="16" max="20000" value="'+
b.freq+'">';c.getElementsByClassName("pk_freq")[0].onchange=function(c){this.value||(this.value=500);this.hasAttribute("data-open")&&(this.parentNode.getElementsByClassName("pk_horiz")[0].value=this.value);l(a,b,{freq:this.value/1},1);n(b)};c.getElementsByClassName("pk_freq")[0].onfocus=function(c){if(!this.hasAttribute("data-open")){var d=this,f=this.parentNode,e=document.createElement("div");e.className="pk_pgeq_freq pk_freq";e.innerHTML='<div class="pk_arr"></div><input type="range" min="16" max="20000" class="pk_horiz pk_freq" step="1" value="'+
b.freq+'">';e.getElementsByClassName("pk_horiz")[0].oninput=function(a){d.value!=this.value&&(d.value=this.value,d.onchange())};f.appendChild(e);this.setAttribute("data-open","1");var g=function(b){if(!b.target.classList.contains("pk_freq")||b.target.type===d.type&&b.target!==d)d.removeAttribute("data-open"),f.removeChild(e),a.el.removeEventListener("mousedown",g)};a.el.addEventListener("mousedown",g,!1)}};g.appendChild(c);c=m.createElement("div");c.innerHTML='<input type="number" class="pk_val pk_q" min="1" max="50" value="'+
b.q+'">';c.getElementsByClassName("pk_q")[0].onchange=function(c){this.value||(this.value=1);this.hasAttribute("data-open")&&(this.parentNode.getElementsByClassName("pk_horiz")[0].value=this.value);l(a,b,{q:this.value/1},1);n(b)};c.getElementsByClassName("pk_q")[0].onfocus=function(c){if(!this.hasAttribute("data-open")){var d=this,e=this.parentNode,f=document.createElement("div");f.className="pk_pgeq_freq pk_q";f.innerHTML='<div class="pk_arr"></div><input type="range" min="1" max="50" class="pk_horiz pk_q" step="0.1" value="'+
b.q+'">';f.getElementsByClassName("pk_horiz")[0].oninput=function(a){d.value!=this.value&&(d.value=this.value,d.onchange())};e.appendChild(f);this.setAttribute("data-open","1");var g=function(b){if(!b.target.classList.contains("pk_q")||b.target.type===d.type&&b.target!==d)d.removeAttribute("data-open"),e.removeChild(f),a.el.removeEventListener("mousedown",g)};a.el.addEventListener("mousedown",g,!1)}};g.appendChild(c);c=m.createElement("div");c.className="pk_del";c.innerHTML='<a style="cursor:pointer">DELETE</a>';
c.getElementsByTagName("a")[0].onclick=function(c){a.Remove(b)};g.appendChild(c);f.appendChild(g);return g}function h(a,b){return"peaking"===a.type&&"peaking"!==b.type?-1:"peaking"===b.type&&"peaking"!==a.type?1:0}var k=this,E=0,A=!1,v=!1;k.act=null;k.ranges=[];k.ui={};this.Callback=function(){};this.Init=function(a){this.el=a;var b=m.createElement("div");b.className="pk_row";a=m.createElement("canvas");var c=m.createElement("canvas");a.className="pk_peq2";c.className="pk_peq";a.width=225;a.height=
112;c.width=450;c.height=225;var f=a.getContext("2d",{alpha:!0,antialias:!1}),g=c.getContext("2d",{alpha:!0,antialias:!1});f.fillStyle="#365457";g.strokeStyle="#FF0000";g.shadowColor="#FF2222";g.shadowBlur=0;var e=m.createElement("div");e.className="pk_peq3 pk_noselect";e.innerHTML='<span>32</span><span style="position:absolute;left:3.5%">500<span></span></span><span style="position:absolute;left:9%">1k<span></span></span><span style="position:absolute;left:19%">2k<span></span></span><span style="position:absolute;left:38%">4k<span></span></span><span style="position:absolute;left:50%">5k<span></span></span><span style="position:absolute;left:59%">8k<span></span></span><span style="position:absolute;left:72%">12k<span></span></span><span style="position:absolute;left:85%">16k<span></span></span><span style="float:right">20k</span>';
var d=m.createElement("div");d.className="pk_peq4 pk_noselect";d.innerHTML='<span style="top:0">35</span><span style="top:10%">28<span></span></span><span style="top:20%">21<span></span></span><span style="top:30%">14<span></span></span><span style="top:40%">7<span></span></span><span>0<span></span></span><span style="top:60%">-7<span></span></span><span style="top:70%">-14<span></span></span><span style="top:80%">-21<span></span></span><span style="top:90%">-28<span></span></span><span style="top:100%">35</span>';
b.appendChild(a);b.appendChild(c);b.appendChild(e);b.appendChild(d);this.el.appendChild(b);b=document.createElement("div");b.className="pk_row pk_noselect pk_pglst";b.innerHTML='<div class="pk_pgeq_els"><span class="pk_txlft">#</span><span>type</span><span>gain</span><span>freq</span><span>Q</span></div>';this.el.appendChild(b);this.ui.ctx_bars=f;this.ui.ctx_eq=g;this.ui.canvas_bars=a;this.ui.canvas_eq=c;this.ui.el_list=b;z(this);this.Render()};this.Add=function(a,b,c,f,g,e,d){a={id:++E,type:a?a:
"peaking",freq:c||0,gain:f||0,q:g||5,_on:b,_hov:!1,_el:null,_coords:{x:e||0,y:d||0},_arr:[]};this.ranges.push(a);this.ranges.sort(h);this.act&&this.act.el.classList.remove("pk_act");this.act=a;n(a);a.el=y(this,a," pk_act");this.Callback&&this.Callback();this.Render()};this.Remove=function(a){for(var b=this.ranges.length;0<b--;)if(this.ranges[b]===a){this.ranges.splice(b,1);break}a.el&&(a.el.parentNode.removeChild(a.el),a.el=null);this.act&&this.act===a&&(this.act=null);this.Render()};var p=function(){A=
!1;var a=k.ui.ctx_eq,b=k.ui.canvas_eq,c=b.width,f=b.height;b=f/2;a.clearRect(0,0,c,f);a.fillStyle="#d9d955";if(0===k.ranges.length)a.beginPath(),a.moveTo(0,b),a.lineTo(c,b),a.stroke();else{var g=!0;for(f=0;f<r;++f);for(var e=0;e<k.ranges.length;++e){var d=k.ranges[e];if(d._on)if(g)for(g=!1,f=0;f<r;++f)q[f]=d._arr[f];else for(f=0;f<r;++f)q[f]+=d._arr[f]}if(g)a.beginPath(),a.moveTo(0,b),a.lineTo(c,b);else{a.beginPath();a.moveTo(0,b-b/35*q[0]);for(f=0;f<r/4;f+=1)g=q[f],e=c/r*f*2,g=b-b/35*g,a.lineTo(e,
g);d=0;for(f=r/4;f<r;f+=3)g=q[f],d+=2,e=c/r*(r/2+d),g=b-b/35*g,a.lineTo(e,g)}a.stroke();for(e=0;e<k.ranges.length;++e)d=k.ranges[e],c=d._coords.x,b=d._coords.y,a.beginPath(),a.arc(c,b,6,0,2*Math.PI,!1),d===k.act?(a.shadowBlur=24,a.fillStyle=d._on?"#fff":"#686868",a.stroke(),a.fill(),a.shadowBlur=0,a.fillStyle="#d9d955"):d._hov?(a.fillStyle=d._on?"blue":"darkblue",a.stroke(),a.fill(),a.fillStyle="#d9d955"):d._on?a.fill():(a.fillStyle="#555",a.fill(),a.fillStyle="#d9d955")}};this.Render=function(){A||
(A=!0,requestAnimationFrame(p))};this.RenderBars=function(a,b){var c=this;v||(v=!0,requestAnimationFrame(function(){v=!1;if(b){var a=c.ui.ctx_bars,g=c.ui.canvas_bars,e=g.width;g=g.height;a.clearRect(0,0,e,g);e=(e/234).toFixed(1)/1;for(var d,k=0,h=0;117>h;++h)d=b[h],d=d/256*g>>0,a.fillRect(k,g-d,e,d),k+=e;for(h=0;117>h;++h)d=b[117+(3.34*h>>0)],d=d/256*g>>0,a.fillRect(k,g-d,e,d),k+=e}}))};var q=Array(1E3),w=null,C=2E4,r=1E3,u=C/r>>0}PKAudioEditor._deps.FxEQ=function(l,m){l.fireEvent("RequestSelect",
1);var n=new D,z=function(h,k){n.RenderBars(h,k)},y=function(){for(var h=[],k=n.ranges,l=0;l<k.length;++l){var m=k[l];m._on&&h.push({type:m.type,freq:m.freq,val:m.gain,q:m.q})}return h};(new PKAudioFXModal({id:"paragraphic_eq",title:"Paragraphic EQ",ondestroy:function(h){l.stopListeningFor("DidAudioProcess",z);l.ui.InteractionHandler.on=!1;l.ui.KeyHandler.removeCallback("modalfxesc");n=null},preview:function(h){l.fireEvent("RequestActionFX_PREVIEW_PARAMEQ",y())},body:"",presets:[{name:"Old Telephone",
val:'1,highpass,0,5800,5.8,1,"lowpass",0,7060,5'}],custom_pres:m.Get("paragraphic_eq"),onpreset:function(h){for(var k=n.ranges.length;0<k--;)n.Remove(n.ranges[k]);var l=n.ui.canvas_eq;k=l.width;l=l.height;h=h.split(",");for(var m=h.length/5>>0,v=0;v<m;++v){var p=[],q=5*v;p[0]=!!(h[q+0]/1);p[1]=h[q+1];p[2]=h[q+2]/1;p[3]=h[q+3]/1;p[4]=h[q+4]/1;q=5E3>p[3]?p[3]/5E3*(k/2):(k/2+(p[3]-5E3)/15E3*(k/2)).toFixed(1)/1;var w="peaking"===p[1]?((1-(p[2]/1+35)/70)*l).toFixed(1)/1:(l/2).toFixed(1)/1;n.Add(p[1],!!p[0],
p[3]/1,p[2]/1,p[4]/1,q,w)}},buttons:[{title:"Apply EQ",clss:"pk_modal_a_accpt",callback:function(h){l.fireEvent("RequestActionFX_PARAMEQ",y());h.Destroy()}}],setup:function(h){n.Init(h.el_body);n.Callback=function(){l.fireEvent("RequestActionFX_UPDATE_PREVIEW",y())};l.listenFor("DidAudioProcess",z);l.fireEvent("RequestPause");l.ui.InteractionHandler.checkAndSet("modalfx");l.ui.KeyHandler.addCallback("modalfxesc",function(k){l.ui.InteractionHandler.check("modalfx")&&h.Destroy()},[27])}},l)).Show()}})(window,
document,PKAudioEditor);