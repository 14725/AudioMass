(function(x,y,k){k._deps.rec=function(b){var k=this,p=null,q=null,e=null,f=null,l=!1,c=0,g=0,m=0,d=[],u=-1,v=4,h=null,n=null,r=0,t=14,w=function(a){0<t?--t:(r+=a.inputBuffer.duration*m,g<=r?0<g&&k.stop():(a=a.inputBuffer.getChannelData(0).slice(0),d[++u]=a,0===--v&&(v=4,b.engine.wavesurfer.DrawTemp(c,d))))};this.isActive=function(){return l};this.setEndingOffset=function(a){g=a};this.start=function(a,d,g,k){if(l)return!1;if(!navigator.mediaDevices)return b.fireEvent("ErrorRec"),b.fireEvent("ShowError",
"No recording device found"),!1;c=a/1;if(isNaN(c)||!c)c=0;r=c;e=b.engine.wavesurfer.backend.getAudioContext();k||(m=b.engine.wavesurfer.backend.buffer?b.engine.wavesurfer.backend.buffer.sampleRate:e.sampleRate);h=d;n=g;navigator.mediaDevices.getUserMedia({audio:!0}).then(function(a){q=a;p=e.createMediaStreamSource(a);f=e.createScriptProcessor(2048,1,1);p.connect(f);f.connect(e.destination);l=!0;n&&n();f.onaudioprocess=w})["catch"](function(a){b.fireEvent("ErrorRec");a&&a.message&&b.fireEvent("ShowError",
a.message)});return!0};this.stop=function(a){l&&(q.getTracks().forEach(function(a){a.stop()}),f.onaudioprocess=null,p.disconnect(),f.disconnect(),l=!1,b.engine.wavesurfer.DrawTemp(null),0<d.length&&!a?h&&h(c/m,d):h&&h(null,null),m=0,t=16,u=-1,c=g=0,d=[],h=n=e=q=null)}}})(window,document,PKAudioEditor);