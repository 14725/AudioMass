(function(h){h._deps.state=function(k,g){k||(k=1);var c=this,h=1,e=g.fireEvent,f=g.listenFor,b=[],d=[];c.getLastUndoState=function(){return b[b.length-1]};c.pushUndoState=function(a){if(!a)return!1;a.id||(a.id=++h);b.length>=k&&b.shift();0<b.length&&b[b.length-1].id!==a.id-1&&(b=[]);0<d.length&&d[0].id!==a.id+1&&(d=[]);b.push(a);e("StatePush",b.length);e("DidStateChange",b,d);return!0};c.popUndoState=function(){var a=b.pop();if(a){0<d.length&&d[0].id!==a.id+1&&(d=[]);var c=g.engine.wavesurfer.backend.buffer;
e("StateDidPop",a,1);a.data=c;d.unshift(a);e("DidStateChange",b,d)}return a};c.shiftRedoState=function(){var a=d.shift();if(a){0<b.length&&b[b.length-1].id!==a.id-1&&(b=[]);var c=g.engine.wavesurfer.backend.buffer;e("StateDidPop",a,0);a.data=c;b.push(a);e("DidStateChange",b,d)}return a};c.clearAllState=function(){b=[];d=[];e("StateClearAll");e("DidStateChange",[],[])};f("StateRequestPush",function(a){c.pushUndoState(a)});f("StateRequestUndo",function(){c.popUndoState()});f("StateRequestRedo",function(){c.shiftRedoState()});
f("StateRequestClearAll",function(){c.clearAllState()});f("StateRequestLastState",function(){e("StateDidLastState",c.getLastUndoState())})}})(PKAudioEditor);