(function(n,x,y){y._deps.engine=function(b){var e=this,a=WaveSurfer.create({container:"#pk_av_"+b.id,scrollParent:!1,hideScrollbar:!0,partialRender:!1,fillParent:!1,pixelRatio:1,progressColor:"rgba(128,85,85,0.24)",splitChannels:!0,autoCenter:!0,height:n.innerHeight-168,plugins:[WaveSurfer.regions.create({dragSelection:{slop:5}})]});this.wavesurfer=a;var f=new b._deps.audioutils(b,a);e.is_ready=!1;this.TrimTo=function(a,c){var b={0:1,1:10,2:100,3:1E3,4:1E4,5:1E5}[c];return(a*b>>0)/b};this.LoadArrayBuffer=
function(d){b.listenFor("RequestCancelModal",function(){a.cancelBufferLoad();a.arraybuffer&&(e.is_ready=!0);b.fireEvent("RequestResize");setTimeout(function(){b.fireEvent("DidDownloadFile")},12);b.stopListeningForName("RequestCancelModal");OneUp("Canceled Loading",1350)});b.fireEvent("RequestZoomUI",0);b.fireEvent("WillDownloadFile");e.is_ready=!1;a.loadBlob(d);b.fireEvent("DidUnloadFile")};this.LoadFile=function(d){0<d.files.length&&("audio/mp3"==d.files[0].type||"audio/wave"==d.files[0].type||"audio/ogg"==
d.files[0].type)&&(b.listenFor("RequestCancelModal",function(){a.cancelBufferLoad();f.DownloadFileCancel();a.arraybuffer&&(e.is_ready=!0);b.fireEvent("RequestResize");setTimeout(function(){b.fireEvent("DidDownloadFile")},12);b.stopListeningForName("RequestCancelModal");OneUp("Canceled Loading",1350)}),b.fireEvent("WillDownloadFile"),e.is_ready=!1,a.loadBlob(d.files[0]),b.fireEvent("DidUnloadFile"))};this.DownloadFile=function(d,c,g){e.is_ready&&(b.fireEvent("WillDownloadFile"),b.listenFor("RequestCancelModal",
function(){f.DownloadFileCancel();a.arraybuffer&&(e.is_ready=!0);b.fireEvent("RequestResize");setTimeout(function(){b.fireEvent("DidDownloadFile")},12);b.stopListeningForName("RequestCancelModal")}),setTimeout(function(){f.DownloadFile(d,c,g,function(a){"done"===a?(setTimeout(function(){b.fireEvent("DidDownloadFile")},12),b.stopListeningForName("RequestCancelModal")):b.fireEvent("DidProgressModal",a)})},220))};this.LoadSample=function(){b.fireEvent("WillDownloadFile");setTimeout(function(){b.listenFor("RequestCancelModal",
function(){a.cancelAjax()&&(a.arraybuffer&&(e.is_ready=!0),b.fireEvent("RequestResize"),setTimeout(function(){b.fireEvent("DidDownloadFile")},12),b.stopListeningForName("RequestCancelModal"),OneUp("Canceled Loading",1350))});a.load("test.mp3");e.is_ready=!1},180)};this.LoadURL=function(d){b.fireEvent("WillDownloadFile");setTimeout(function(){b.listenFor("RequestCancelModal",function(){a.cancelAjax()&&(a.arraybuffer&&(e.is_ready=!0),b.fireEvent("RequestResize"),setTimeout(function(){b.fireEvent("DidDownloadFile")},
12),b.stopListeningForName("RequestCancelModal"),OneUp("Canceled Loading",1350))});a.load(d);e.is_ready=!1},180)};b.listenFor("RequestResize",function(){a.fireEvent("resize");var d=window.innerHeight;a.setHeight((300>d?300:d)-168-(b.ui.BarBtm.on?b.ui.BarBtm.height:0))});a.on("ready",function(){b.fireEvent("DidReadyFire");if(!e.is_ready){e.is_ready=!0;var d=document.getElementsByClassName("pk_tmpMsg");0<d.length&&(d=d[0],d.parentNode.removeChild(d));k=null;b.fireEvent("DidDownloadFile");b.fireEvent("StateRequestClearAll");
b.fireEvent("DidLoadFile");b.fireEvent("DidUpdateLen",a.getDuration());b.fireEvent("DidSetClipboard",0);b.fireEvent("RequestSeekTo",0);b.fireEvent("RequestResize");a.getWaveEl().style.opacity="1";b.stopListeningForName("RequestCancelModal");setTimeout(function(){OneUp("Loaded Succesfully")},180);1===a.backend.buffer.numberOfChannels?(a.backend.SetNumberOfChannels(1),a.ActiveChannels=[1],a.drawer.params.ActiveChannels=a.ActiveChannels,a.SelectedChannelsLen=1,b.el.classList.add("pk_mono")):2===a.backend.buffer.numberOfChannels&&
(a.backend.SetNumberOfChannels(2),a.ActiveChannels=[1,1],a.drawer.params.ActiveChannels=a.ActiveChannels,a.SelectedChannelsLen=2,b.el.classList.remove("pk_mono"))}});a.on("pause",function(){b.fireEvent("DidStopPlay")});a.on("play",function(){b.fireEvent("DidPlay")});a.on("seek",function(){var d=a.getCurrentTime(),c=a.getLoudness();b.fireEvent("DidAudioProcess",[d,c])});b.listenFor("RequestStop",function(d){if(b.rec.isActive())return b.fireEvent("RequestActionRecordStop"),!1;var c=a.regions.list[0];
c&&(a.ActiveMarker=c.start/a.getDuration());a.stop(d)});b.listenFor("RequestPlay",function(d){b.fireEvent("RequestActionRecordStop");!d&&a.isPlaying()&&a.stop();a.play()});b.listenFor("RequestPause",function(){b.fireEvent("RequestActionRecordStop");a.pause()});b.listenFor("RequestSetLoop",function(){if(e.is_ready){var d=!1;a.regions.list[0]?a.regions.list[0].loop=a.regions.list[0].loop?!1:!0:(d=!0,a.regions.add({start:.01,end:a.getDuration()-.01,id:"t"}),a.regions.list[0].loop=!0);var c=a.regions.list[0].loop;
b.fireEvent("DidSetLoop",c);c&&!d&&b.fireEvent("RequestSeekTo",a.regions.list[0].start/a.getDuration())}});b.listenFor("RequestSkipBack",function(b){a.skipBackward(b)});b.listenFor("RequestSkipFront",function(b){a.skipForward(b)});b.listenFor("RequestSeekTo",function(b){a.seekTo(b)});b.ui.KeyHandler.addCallback("zkA",function(a,b,e){e.preventDefault()},[38]);b.ui.KeyHandler.addCallback("zkD",function(a,b,e){e.preventDefault()},[40]);b.ui.KeyHandler.addSingleCallback("KeyPlayPause",function(a){b.ui.InteractionHandler.on||
a.preventDefault()},32);b.ui.KeyHandler.addSingleCallback("KeyTilda",function(a){b.ui.InteractionHandler.on||(a.preventDefault(),b.fireEvent("RequestDeselect"))},96);b.ui.KeyHandler.addCallback("kF12",function(a,b,e){e.preventDefault();e.stopPropagation()},[123]);b.ui.KeyHandler.addCallback("KeyShiftSpace"+b.id,function(d){b.ui.InteractionHandler.on||a.playPause()},[16,32]);b.ui.KeyHandler.addCallback("KeySpace"+b.id,function(a,c){b.ui.InteractionHandler.on||1!==c[16]&&(PKAudioEditor.engine.wavesurfer.isPlaying()?
b.fireEvent("RequestStop"):b.fireEvent("RequestPlay"))},[32]);b.ui.KeyHandler.addCallback("KeyShiftCopy"+b.id,function(a){b.ui.InteractionHandler.on||b.fireEvent("RequestActionCopy")},[16,67]);b.ui.KeyHandler.addCallback("KeyShiftUndo"+b.id,function(a){b.ui.InteractionHandler.on||b.fireEvent("StateRequestUndo")},[16,90]);b.ui.KeyHandler.addCallback("KeyShiftRedo"+b.id,function(a){b.ui.InteractionHandler.on||b.fireEvent("StateRequestRedo")},[16,89]);b.ui.KeyHandler.addCallback("KeyShiftPaste"+b.id,
function(a){b.ui.InteractionHandler.on||b.fireEvent("RequestActionPaste")},[16,86]);b.ui.KeyHandler.addCallback("KeyShiftCut"+b.id,function(a){b.ui.InteractionHandler.on||b.fireEvent("RequestActionCut")},[16,88]);b.ui.KeyHandler.addCallback("KeyShiftSelectAll"+b.id,function(a){b.ui.InteractionHandler.on||b.fireEvent("RequestSelect")},[16,65]);b.ui.KeyHandler.addSingleCallback("KeyLoopToggle",function(a){b.ui.InteractionHandler.on||(a.preventDefault(),a.stopPropagation(),b.fireEvent("RequestSetLoop"))},
108);a.container.addEventListener("mousedown",function(a){3===a.which&&a.preventDefault()},!1);b.listenFor("RequestSelect",function(d,c){if(e.is_ready){if(d&&a.regions.list[0])return!1;c?(a.regions.add({start:c[0],end:c[1],id:"t"}),a.isPlaying()||setTimeout(function(){b.fireEvent("RequestSeekTo",c[0]/a.getDuration())},0)):(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),a.isPlaying()||setTimeout(function(){b.fireEvent("RequestSeekTo",.001)},0))}});b.listenFor("RequestDeselect",function(){a.regions.clear();
b.fireEvent("RequestSeekTo",0)});(function(){var d=null;b.listenFor("RequestLoadLocalFile",function(){a.pause();d&&(d.parentNode.removeChild(d),d.onchange=null);d=x.createElement("input");d.setAttribute("type","file");d.setAttribute("accept","audio/*");d.className="pk_inpfile";d.onchange=function(){e.LoadFile(d);d.parentNode.removeChild(d);d=d.onchange=null};b.el.appendChild(d);d.click()})})();a.container.addEventListener("dblclick",function(d){b.fireEvent("RequestSelect",!1,[a.LeftProgress,a.LeftProgress+
a.VisibleDuration])},!1);a.container.addEventListener("click",function(d){e.is_ready&&(b.ui.KeyHandler.keyMap[16]||a.regions.clear())},!1);var r=null;n.addEventListener("resize",function(){a&&(r&&clearTimeout(r),r=setTimeout(function(){b.fireEvent("RequestResize")},82))},!1);n.addEventListener("beforeunload",function(a){b.fireEvent("WillUnload")});a.on("error",function(a){setTimeout(function(){b.fireEvent("DidDownloadFile");e.is_ready=!1},20);b.fireEvent("ShowError",a)});a.on("audioprocess",function(d){d=
a.getCurrentTime();var c=a.getLoudness();b.fireEvent("DidAudioProcess",[d,c],a.backend.FreqArr)});a.on("DidZoom",function(d){b.fireEvent("DidZoom",[a.ZoomFactor,a.LeftProgress/a.getDuration()*100,a.params.verticalZoom],d)});a.on("region-removed",function(){b.fireEvent("DidSetLoop",0);b.fireEvent("DidDestroyRegion")});b.listenFor("RequestRegionClear",function(){a.regions.clear()});b.listenFor("RequestRegionSet",function(b,c){e.is_ready&&(b||(b=a.LeftProgress/1),c||(c=(a.LeftProgress+a.VisibleDuration)/
1),a.regions.clear(),a.regions.add({start:b,end:c,id:"t"}))});var k=null;b.listenFor("RequestActionCut",function(){if(e.is_ready){var d=a.regions.list[0];if(!d)return!1;b.fireEvent("RequestPause");var c=e.TrimTo(d.start,3);d=e.TrimTo(d.end-d.start,3);b.fireEvent("StateRequestPush",{desc:"Cut",meta:[c,d],data:a.backend.buffer});var g=f.Trim(c,d);a.regions.clear();var l=c-.03;0>l&&(l=0);b.fireEvent("RequestSeekTo",l/a.getDuration());k=g;b.fireEvent("DidSetClipboard",1);b.fireEvent("DidCut",g);OneUp("Cut :: "+
e.TrimTo(c,2)+" to "+e.TrimTo(c/1+d/1,2),1100)}});b.listenFor("RequestActionCopy",function(){if(e.is_ready){var d=a.regions.list[0];if(!d)return!1;b.fireEvent("RequestPause");var c=e.TrimTo(d.start,3);d=e.TrimTo(d.end-d.start,3);k=c=f.Copy(c,d);b.fireEvent("DidSetClipboard",1);b.fireEvent("DidCopy",c);OneUp("Copied range")}});b.listenFor("RequestActionSilence",function(d,c){if(e.is_ready){b.fireEvent("RequestPause");if(!c||0>c)c=1;b.fireEvent("StateRequestPush",{desc:"Silence",meta:[d,c],data:a.backend.buffer});
var g=f.Insert(d,f.MakeSilence(c));a.regions.clear();a.regions.add({start:g[0],end:g[1],id:"t"});b.fireEvent("RequestSeekTo",g[0]/a.getDuration());OneUp("Inserted Silence")}});b.listenFor("RequestActionPaste",function(){function d(c,d){b.fireEvent("StateRequestPush",{desc:"Paste",meta:[c,d],data:a.backend.buffer})}if(e.is_ready){if(!k)return!1;b.fireEvent("RequestPause");var c=a.regions.list[0],g=[0,0];c?(g=e.TrimTo(c.start,3),c=e.TrimTo(c.end-c.start,3),d(g,c),g=f.Replace(g,c,k)):(c=e.TrimTo(a.getCurrentTime(),
3),d(c),g=f.Insert(c,k));a.regions.clear();a.regions.add({start:g[0],end:g[1],id:"t"});b.fireEvent("RequestSeekTo",g[0]/a.getDuration());OneUp("Paste to "+g[0].toFixed(2),982)}});var t=!1;b.listenFor("RequestActionRecordToggle",function(){e.is_ready&&(b.rec.isActive()?b.fireEvent("RequestActionRecordStop"):t||(t=!0,setTimeout(function(){b.fireEvent("RequestActionRecordStart");setTimeout(function(){t=!1},50)},40)))});b.listenFor("RequestActionRecordStop",function(){if(e.is_ready){if(!b.rec.isActive())return!1;
b.rec.stop()}});b.listenFor("RequestActionRecordStart",function(){if(e.is_ready){b.fireEvent("RequestPause");if(b.rec.isActive())return!1;var d=a.getCurrentTime()*a.backend.buffer.sampleRate;b.rec.start(d,function(c,d){b.fireEvent("DidActionRecordStop",!!d);if(d){b.fireEvent("StateRequestPush",{desc:"Record Audio",meta:[c,void 0],data:a.backend.buffer});var e=f.ReplaceFloatArrays(c,d);a.regions.clear();a.regions.add({start:e[0],end:e[1],id:"t"});b.fireEvent("RequestSeekTo",e[0]/a.getDuration());OneUp("Recorded Audio "+
e[0].toFixed(2),982)}},function(){b.fireEvent("DidActionRecordStart")});(d=a.regions.list[0])?b.rec.setEndingOffset(d.end*a.backend.buffer.sampleRate):b.rec.setEndingOffset(a.getDuration()*a.backend.buffer.sampleRate)}});b.listenFor("RequestActionFX_PREVIEW_HardLimit",function(d){if(e.is_ready)if(f.previewing)f.FXPreviewStop(),b.fireEvent("DidStopPreview");else{var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=
e.TrimTo(c.end-c.start,3);f.FXPreview(g,c,f.FXBank.HardLimit(d));b.fireEvent("DidStartPreview")}});b.listenFor("RequestActionFX_HardLimit",function(d){if(e.is_ready){b.fireEvent("RequestPause");var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);b.fireEvent("StateRequestPush",{desc:"Apply Hard Limit (fx)",meta:[g,c],data:a.backend.buffer});f.FX(g,c,f.FXBank.HardLimit(d));OneUp("Applied Hard Limit (fx)")}});
b.listenFor("RequestActionFX_PARAMEQ",function(d){if(e.is_ready){b.fireEvent("RequestPause");var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);b.fireEvent("StateRequestPush",{desc:"Apply Parametric EQ (fx)",meta:[g,c],data:a.backend.buffer});f.FX(g,c,f.FXBank.ParametricEQ(d));OneUp("Applied Parametric EQ (fx)")}});b.listenFor("RequestActionFX_PREVIEW_PARAMEQ",function(d){if(e.is_ready)if(f.previewing)f.FXPreviewStop(),
b.fireEvent("DidStopPreview");else{var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);f.FXPreview(g,c,f.FXBank.ParametricEQ(d));b.fireEvent("DidStartPreview")}});b.listenFor("RequestActionFX_PREVIEW_DISTORT",function(d){if(e.is_ready)if(f.previewing)f.FXPreviewStop(),b.fireEvent("DidStopPreview");else{var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),
c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);f.FXPreview(g,c,f.FXBank.Distortion(d));b.fireEvent("DidStartPreview")}});b.listenFor("RequestActionFX_DISTORT",function(d){if(e.is_ready){b.fireEvent("RequestPause");var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);b.fireEvent("StateRequestPush",{desc:"Apply Distortion (fx)",meta:[g,c],data:a.backend.buffer});
f.FX(g,c,f.FXBank.Distortion(d));OneUp("Applied Distortion (fx)")}});b.listenFor("RequestActionFX_PREVIEW_DELAY",function(d){if(e.is_ready)if(f.previewing)f.FXPreviewStop(),b.fireEvent("DidStopPreview");else{var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);f.FXPreview(g,c,f.FXBank.Delay(d));b.fireEvent("DidStartPreview")}});b.listenFor("RequestActionFX_DELAY",function(d){if(e.is_ready){b.fireEvent("RequestPause");
var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);b.fireEvent("StateRequestPush",{desc:"Apply Delay (fx)",meta:[g,c],data:a.backend.buffer});f.FX(g,c,f.FXBank.Delay(d));OneUp("Applied Delay (fx)")}});b.listenFor("RequestActionFX_PREVIEW_REVERB",function(d){if(e.is_ready)if(f.previewing)f.FXPreviewStop(),b.fireEvent("DidStopPreview");else{var c=a.regions.list[0];c||(a.regions.add({start:.001,
end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);f.FXPreview(g,c,f.FXBank.Reverb(d));b.fireEvent("DidStartPreview")}});b.listenFor("RequestActionFX_REVERB",function(d){if(e.is_ready){b.fireEvent("RequestPause");var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);b.fireEvent("StateRequestPush",{desc:"Apply Reverb (fx)",meta:[g,c],
data:a.backend.buffer});f.FX(g,c,f.FXBank.Reverb(d));OneUp("Applied Reverb (fx)")}});b.listenFor("RequestActionFX_PREVIEW_COMPRESSOR",function(d){if(e.is_ready)if(f.previewing)f.FXPreviewStop(),b.fireEvent("DidStopPreview");else{var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);f.FXPreview(g,c,f.FXBank.Compressor(d));b.fireEvent("DidStartPreview")}});b.listenFor("RequestActionFX_Compressor",
function(d){if(e.is_ready){b.fireEvent("RequestPause");var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);b.fireEvent("StateRequestPush",{desc:"Apply Compressor (fx)",meta:[g,c],data:a.backend.buffer});f.FX(g,c,f.FXBank.Compressor(d));OneUp("Applied Compressor (fx)")}});b.listenFor("RequestActionFX_Normalize",function(d){if(e.is_ready){b.fireEvent("RequestPause");var c=a.regions.list[0];
c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);b.fireEvent("StateRequestPush",{desc:"Normalize ",meta:[g,c],data:a.backend.buffer});f.FX(g,c,f.FXBank.Normalize(d));OneUp("Applied Normalize")}});b.listenFor("RequestActionFX_Invert",function(d){if(e.is_ready){b.fireEvent("RequestPause");var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);d=e.TrimTo(c.start,
3);c=e.TrimTo(c.end-c.start,3);b.fireEvent("StateRequestPush",{desc:"Invert ",meta:[d,c],data:a.backend.buffer});f.FX(d,c,f.FXBank.Invert());OneUp("Applied Invert")}});b.listenFor("RequestActionFX_Reverse",function(d){if(e.is_ready){b.fireEvent("RequestPause");var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);d=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);b.fireEvent("StateRequestPush",{desc:"Reverse ",meta:[d,c],data:a.backend.buffer});
f.FX(d,c,f.FXBank.Reverse());OneUp("Applied Reverse")}});b.listenFor("RequestActionFX_FadeIn",function(d){if(e.is_ready){b.fireEvent("RequestPause");var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);d=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);b.fireEvent("StateRequestPush",{desc:"Apply Fade In (fx)",meta:[d,c],data:a.backend.buffer});f.FX(d,c,f.FXBank.FadeIn());OneUp("Applied Fade In (fx)")}});b.listenFor("RequestActionFX_FadeOut",function(d){if(e.is_ready){b.fireEvent("RequestPause");
var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);d=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);b.fireEvent("StateRequestPush",{desc:"Apply Fade Out (fx)",meta:[d,c],data:a.backend.buffer});f.FX(d,c,f.FXBank.FadeOut());OneUp("Applied Fade Out (fx)")}});var w=null;b.listenFor("RequestActionFX_UPDATE_PREVIEW",function(a){f.previewing&&(clearTimeout(w),w=setTimeout(function(){f.FXPreviewUpdate(a)},44))});b.listenFor("RequestActionFX_TOGGLE",
function(a){a?f.FXPreviewInit(!0):b.fireEvent("DidTogglePreview",f.FXPreviewToggle())});b.listenFor("RequestActionFX_PREVIEW_STOP",function(){f.FXPreviewStop();b.fireEvent("DidStopPreview")});b.listenFor("RequestActionFX_PREVIEW_GAIN",function(d){if(e.is_ready)if(f.previewing)f.FXPreviewStop(),b.fireEvent("DidStopPreview");else{var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);f.FXPreview(g,
c,f.FXBank.Gain(d));b.fireEvent("DidStartPreview")}});b.listenFor("RequestActionFX_GAIN",function(d){if(e.is_ready){b.fireEvent("RequestPause");var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);b.fireEvent("StateRequestPush",{desc:"Apply Gain (fx)",meta:[g,c],data:a.backend.buffer});f.FX(g,c,f.FXBank.Gain(d));OneUp("Applied Gain (fx)")}});b.listenFor("RequestActionFX_PREVIEW_SPEED",function(d){if(e.is_ready)if(f.previewing)f.FXPreviewStop(),
b.fireEvent("DidStopPreview");else{var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3);c=e.TrimTo(c.end-c.start,3);f.FXPreview(g,c,f.FXBank.Speed(d));b.fireEvent("DidStartPreview")}});b.listenFor("RequestActionFX_SPEED",function(d){if(e.is_ready){b.fireEvent("RequestPause");var c=a.regions.list[0];c||(a.regions.add({start:.001,end:a.getDuration()-.001,id:"t"}),c=a.regions.list[0]);var g=e.TrimTo(c.start,3),l=e.TrimTo(c.end-
c.start,3),p=(c.end-c.start)/d;p=e.TrimTo(p,3);b.fireEvent("StateRequestPush",{desc:"Apply Speed (fx)",meta:[g,l],data:a.backend.buffer});var h=f.Copy(g,l);c=a.backend.buffer;var k=p/1*c.sampleRate>>0;d=f.FXBank.Speed(d);c=new (window.OfflineAudioContext||window.webkitOfflineAudioContext)(a.SelectedChannelsLen,k,c.sampleRate);var q=c.createBufferSource();q.buffer=h;var m=d.filter(c,c.destination,q,p);q.start();var n=function(c){f.Replace(g,l,c);a.regions.clear();a.regions.add({start:g,end:g+p,id:"t"});
b.fireEvent("RequestSeekTo",g/a.getDuration());OneUp("Applied Speed (fx)");if(0<m.length)for(c=0;c<m.length;++c)m[c].disconnect();else m&&m.disconnect&&m.disconnect();h=m=null;q.disconnect()};(d=c.startRendering())?d.then(n)["catch"](function(a){console.log("Rendering failed: "+a)}):c.oncomplete=function(a){n(a.renderedBuffer)}}});b.listenFor("StateDidPop",function(d,c){e.is_ready&&(b.fireEvent("RequestPause"),a.regions.clear(),a.loadDecodedBuffer(d.data),d.meta&&0<d.meta.length&&(d.meta[1]?a.regions.add({start:d.meta[0]/
1,end:d.meta[0]/1+d.meta[1]/1,id:"t"}):b.fireEvent("RequestSeekTo",d.meta[0]/a.getDuration())),c?OneUp("Undo "+d.desc):OneUp("Redo "+d.desc))});b.listenFor("RequestChanToggle",function(d,c){if(!e.is_ready||a.ActiveChannels.length<=d)return!1;var g=a.ActiveChannels[d];var f=c?c:1===g?0:1;g!==f&&(a.ActiveChannels[d]=f,0===f?(--a.SelectedChannelsLen,0===d?a.backend.gainNode2.gain.value=0:a.backend.gainNode1.gain.value=0):(++a.SelectedChannelsLen,0===d?a.backend.gainNode2.gain.value=1:a.backend.gainNode1.gain.value=
1),a.ForceDraw(),b.fireEvent("DidChanToggle",d,f))});a.on("region-updated",function(){a.regions.list[0]&&b.fireEvent("DidCreateRegion",a.regions.list[0])});a.on("region-update-end",function(){b.fireEvent("DidCreateRegion",a.regions.list[0]);var d=a.regions.list[0].start;a.isPlaying()||b.fireEvent("RequestSeekTo",d/a.getDuration())});a.on("cursorcenter",function(a){b.fireEvent("DidCursorCenter",a)});var h=a.drawer.canvases[0].wave.parentNode,u=0,v=function(a){b.fireEvent("RequestPan",u-a.clientX);
u=a.clientX};b.listenFor("RequestZoom",function(d,c){d*=a.ZoomFactor;if(-1===c){var e=a.drawer.width;e-=e/a.ZoomFactor;var f=a.ZoomFactor-1;if(0>=f)return;var h=a.ZoomFactor;a.ZoomFactor+=d*f/e;1>a.ZoomFactor&&(a.ZoomFactor=1);e=a.getDuration()/a.ZoomFactor;if(.5>=e){a.ZoomFactor=h;return}a.VisibleDuration=e;a.LeftProgress+=d/a.drawer.width*a.VisibleDuration;a.LeftProgress+a.VisibleDuration>=a.getDuration()?a.LeftProgress=a.getDuration()-a.VisibleDuration:0>a.LeftProgress&&(a.LeftProgress=0)}else if(1===
c){e=a.drawer.width;e-=e/a.ZoomFactor;f=a.ZoomFactor-1;if(0>=f)return;h=a.ZoomFactor;a.ZoomFactor-=d*f/e;1>a.ZoomFactor&&(a.ZoomFactor=1);e=a.getDuration()/a.ZoomFactor;if(e+a.LeftProgress>a.getDuration())a.ZoomFactor=h;else{if(.5>=e){a.ZoomFactor=h;return}a.VisibleDuration=e}}a.ForceDraw();b.fireEvent("DidZoom",[a.ZoomFactor,a.LeftProgress/a.getDuration()*100,a.params.verticalZoom])});b.listenFor("RequestPan",function(d,c){if(1===c)d*=a.ZoomFactor;else if(2===c){var e=a.getDuration()*(d/a.drawer.width);
a.LeftProgress=e;a.ForceDraw();b.fireEvent("DidZoom",[a.ZoomFactor,a.LeftProgress/a.getDuration()*100,a.params.verticalZoom]);return}0<a.ZoomFactor&&(e=d/a.drawer.width*a.VisibleDuration,a.LeftProgress+=e,a.LeftProgress+a.VisibleDuration>=a.getDuration()?a.LeftProgress=a.getDuration()-a.VisibleDuration:0>a.LeftProgress&&(a.LeftProgress=0),a.ForceDraw(),b.fireEvent("DidZoom",[a.ZoomFactor,a.LeftProgress/a.getDuration()*100,a.params.verticalZoom]))});h.addEventListener("mousedown",function(d){if(3===
d.which)return d.preventDefault(),a.Interacting|=2,u=d.clientX,h.className="pk_grabbing",document.addEventListener("mousemove",v,!1),!1;b.fireEvent("MouseDown");b.fireEvent("RequestChanToggle",0,1);b.fireEvent("RequestChanToggle",1,1)},!1);h.addEventListener("mouseleave",function(b){document.removeEventListener("mousemove",v);""!==h.className&&(h.className="",setTimeout(function(){a.Interacting&=-3},20))},!1);h.addEventListener("mouseup",function(b){3===b.which&&(""!==h.className&&(h.className="",
setTimeout(function(){a.Interacting&=-3},20)),document.removeEventListener("mousemove",v))},!1);b.fireEvent("RequestResize");b.listenFor("RequestViewFollowCursorToggle",function(){var d=!a.FollowCursor;(a.FollowCursor=d)&&e.is_ready&&a.CursorCenter();b.fireEvent("DidViewFollowCursorToggle",d)});b.listenFor("RequestViewPeakSeparatorToggle",function(){if(e.is_ready){var d=!a.params.limits;a.params.limits=d;a.ForceDraw();b.fireEvent("DidViewPeakSeparatorToggle",d)}});b.listenFor("RequestViewTimelineToggle",
function(){if(e.is_ready){var d=!a.params.timeline;a.params.timeline=d;a.ForceDraw();b.fireEvent("DidViewTimelineToggle",d)}});b.listenFor("RequestViewCenterToCursor",function(){e.is_ready&&a.CursorCenter()});b.listenFor("RequestZoomUI",function(b,c){e.is_ready&&(0===b?a.ResetZoom():("h"===b&&a.SetZoom(.5,c),"v"===b&&a.SetZoomVertical(c)))})}})(window,document,PKAudioEditor);