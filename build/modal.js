(function(p,g){function n(b){var d=this;this.id=b.id?b.id:++q;var m=g.createElement("div");this.els={toolbar:[],bottom:[]};m.className="pk_modal "+(b.clss?b.clss:"");d.el=m;var a=g.createElement("div");a.className="pk_modal_back";this.el_back=a;a=g.createElement("div");a.className="pk_noselect pk_modal_title";a.innerHTML="<span>"+(b.title||"")+"</span>";m.appendChild(a);this.el_title=a;var l=g.createElement("div");l.className="pk_modal_main";m.appendChild(l);this.el_body=l;l=g.createElement("div");
l.className="pk_noselect pk_modal_bottom";var f=g.createElement("a");f.innerHTML="CANCEL";f.className="pk_modal_cancel pk_modal_a_bottom";f.onclick=function(){d.Destroy()};l.appendChild(f);if(b.buttons&&0<b.buttons.length)for(f=0;f<b.buttons.length;++f){var c=b.buttons[f];if(c.title&&c.callback){var h=g.createElement("a");h.innerHTML=c.title;h.className="pk_modal_a_bottom "+(c.clss?c.clss:"");c.callback&&function(a){h.onclick=function(){a(d)}}(c.callback);d.els.bottom.push(h);l.appendChild(h)}}m.appendChild(l);
if(b.toolbar&&0<b.toolbar.length)for(f=0;f<b.toolbar.length;++f)if(c=b.toolbar[f],c.title&&c.callback){var e=g.createElement("a");e.innerHTML=c.title;e.className="pk_modal_a_top "+(c.clss?c.clss:"");a.appendChild(e);c.callback&&function(a){e.onclick=function(){a(d,this)}}(c.callback);d.els.toolbar.push(e)}this.ondestroy=b.ondestroy;b.body&&(d.el_body.innerHTML=b.body);b.onpreset&&(this.onpreset=b.onpreset);b.setup&&b.setup(this)}var q=0;n.prototype.Show=function(){this.el_back.appendChild(this.el);
g.body.appendChild(this.el_back);return this};n.prototype.Destroy=function(){this.ondestroy&&(this.ondestroy(this),this.ondestroy=null);this.els=null;g.body.removeChild(this.el_back)};p.PKSimpleModal=n;p.PKAudioFXModal=function(b,d){var g=null;b.preview&&(g=[{title:"ON",clss:"pk_inact",callback:function(a,b){d.fireEvent("RequestActionFX_TOGGLE")}},{title:"Preview",callback:function(a){b.preview&&b.preview(a)}}]);return new n({id:b.id,title:b.title,clss:b.clss,presets:b.presets,updateFilter:b.updateFilter,
ondestroy:function(a){d.fireEvent("DidCloseFX_UI");d.stopListeningFor("DidStartPreview",a._evstart);d.stopListeningFor("DidStopPreview",a._evstop);d.stopListeningFor("DidTogglePreview",a._evtoggle);d.stopListeningFor("DidSetPresets",a._updatePresets);d.stopListeningFor("RequestActionFX_UPDATE_PREVIEW",a._updpreview);d.stopListeningFor("RequestSetPresetActive",a._updpreset);d.fireEvent("RequestActionFX_PREVIEW_STOP");b.ondestroy&&b.ondestroy(a)},toolbar:g,buttons:b.buttons,body:b.body,onpreset:b.onpreset,
setup:function(a){d.fireEvent("RequestActionFX_TOGGLE",1);a._evstart=function(){a.els.toolbar[0].classList.remove("pk_inact");a.els.toolbar[1].classList.add("pk_act")};a._evstop=function(){a.els.toolbar[0].classList.add("pk_inact");a.els.toolbar[1].classList.remove("pk_act")};a._evtoggle=function(b){a.els.toolbar[0].innerHTML=b?"ON":"OFF"};a._updpreview=function(b){var f=a.el_presets.options[a.el_presets.selectedIndex],c=a.el.getElementsByClassName("pk_sel_edt")[0];"t"===b?f&&f.getAttribute("data-custom")?
(c.style.visibility="visible",c.style.opacity="1",d.stopListeningFor("RequestActionFX_UPDATE_PREVIEW",a._updpreview)):(c.style.visibility="hidden",c.style.opacity="0",d.stopListeningFor("RequestActionFX_UPDATE_PREVIEW",a._updpreview),setTimeout(function(){d.listenFor("RequestActionFX_UPDATE_PREVIEW",a._updpreview)},100)):(c.style.visibility="visible",c.style.opacity="1",d.stopListeningFor("RequestActionFX_UPDATE_PREVIEW",a._updpreview))};a._updpreset=function(b,d){if(!b||b===a.id)for(var c=a.el_presets.getElementsByTagName("option"),
f=c.length,e;0<f--;)if(e=c[f],e.getAttribute("data-custom")===d){e.selected="selected";break}};a._updatePresets=function(b,f){if(!b||b===a.id){var c=document,h=a.el.getElementsByClassName("pk_sel");if(0<h.length){h=h[0];for(var e=h.getElementsByTagName("option"),g=e.length,k=null;0<g--;)k=e[g],k.getAttribute("data-custom")&&h.removeChild(k);if(0!==f.length)for(e=c.createElement("option"),e.setAttribute("disabled","1"),e.setAttribute("data-custom","1"),e.innerHTML="----custom-----",h.appendChild(e),
g=0;g<f.length;++g)e=c.createElement("option"),k=f[g],e.value=k.val,e.setAttribute("data-custom",k.id),e.innerHTML=k.name,h.appendChild(e)}else if(h=c.createElement("select"),h.className="pk_sel",0!==f.length){for(g=-1;g<f.length;++g)e=c.createElement("option"),-1===g?(e.value="null",e.innerHTML="Presets"):(k=f[g],e.value=k.val,e.innerHTML=k.name),h.appendChild(e);h.onchange=function(){var b=this.value.split(","),c=a.el.getElementsByTagName("input");a._updpreview("t");if(a.onpreset)a.onpreset(this.value);
else for(var d=c.length,e=0;e<d&&b[e];++e){var g=b[e].trim(),f=c[e];"null"!==g&&("checkbox"===f.type||"radio"===f.type?f.checked=g:(f.value=g,f.oninput&&f.oninput.apply(f)))}};k=a.el.getElementsByClassName("pk_modal_bottom")[0];k.appendChild(h);a.el_presets=h;c=c.createElement("a");c.className="pk_sel_edt";c.innerHTML="...<span>Save or Modify preset</span>";c.onclick=function(){d.fireEvent("RequestSavePreset")};k.appendChild(c);d.listenFor("RequestActionFX_UPDATE_PREVIEW",a._updpreview);d.listenFor("RequestSetPresetActive",
a._updpreset)}}};d.listenFor("DidStartPreview",a._evstart);d.listenFor("DidStopPreview",a._evstop);d.listenFor("DidTogglePreview",a._evtoggle);d.fireEvent("DidOpenFX_UI",a);b.updateFilter&&(a.updateFilter=b.updateFilter);b.presets&&(a._updatePresets(null,b.presets),b.custom_pres&&a._updatePresets(null,b.custom_pres),d.listenFor("DidSetPresets",a._updatePresets));b.setup&&b.setup(a)}})}})(window,document);