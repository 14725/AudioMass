(function(m,k,v){var n=[],p={},w=0,q=["mousedown","touchup"],l=function(a,b){if(a&&0!==n.length){var d=a.target||a.srcElement;if(!d||-1===d.className.indexOf("_action")||b){for(d=n.length;d--;){for(var c=n[d],e=c.currentMenu.getElementsByTagName("*"),g=e.length;g--;)e[g].parentNode.removeChild(e[g]);c.currentMenu.removeEventListener(q,t);k.body.removeChild(c.currentMenu);c.currentMenu=null}n=[]}}},t=function(a){a.stopPropagation()},u=function(a,b,d){l(null);n.push(a);var c=k.createElement("div"),
e=a.options;b-=4;d-=4;c.className="pk_contextMenu "+a.menuClass;c.id=a.token;for(var g=0,h=e.length;g<h;++g){if(e[g].isHTML){var f=k.createElement("div");f.innerHTML=e[g].isHTML}else f=k.createElement("a"),f.className="pk_ctx_action",f.cnt=1,f.innerHTML=e[g].name,f.callback=e[g].callback,f.addEventListener("click",f.callback,!1);c.appendChild(f)}a.currentMenu=c;c.addEventListener(q,t,!1);k.body.appendChild(c);e=c.offsetWidth;f=c.offsetHeight;c.style.cssText=m.innerWidth<b+e&&m.innerHeight<d+f?"top:"+
(d-f)+"px;left:"+(b-e)+"px;":m.innerWidth<b+e?"top:"+d+"px;left:"+(b-e)+"px;":m.innerHeight<d+f?"top:"+(d-f)+"px;left:"+b+"px;":"top:"+d+"px;left:"+b+"px;";if(a.onOpen)a.onOpen(a,c);return!1},r=function(a){a?(a.preventDefault(),a.stopPropagation()):a={pageX:0,pageY:0};var b=p[this.getAttribute("data-token")],d=a.pageX||a.clientX+k.documentElement.scrollLeft,c=a.pageY||a.clientY+k.documentElement.scrollTop;if(!b)return!1;b.curr_target=a.target||a.srcElement;u(b,d,c)},h=m.contextMenu=function(a,b){if(!(this instanceof
h))return new h(a,b);b||(b={});this.elem=a;this.options=[];this.menuClass=b.className||"pk_open";this.curr_target=null;a&&a.addEventListener("pk_ctxmn",r,!1);this.token=++w;a&&a.setAttribute("data-token",this.token);p[this.token]=this};h.prototype.open=function(a){r.call(this.elem,a)};h.prototype.close=function(a){l()};h.prototype.openWithToken=function(a,b,d){u(p[a],b||0,d||0)};h.prototype.destroy=function(){this.elem.removeEventListener("pk_ctxmn",r);l();p[this.token]=null;return!1};h.prototype.addOption=
function(a,b,d){var c=this;this.options.push({name:a,callback:function(a){b&&b(c,c._open);l(c,!0)},isHTML:d})};k.addEventListener(q[0],l,!1);k.addEventListener("killCTX",l,!1);v._deps.ContextMenu=h})(window,document,PKAudioEditor);