var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var d=0;return function(){return d<b.length?{done:!1,value:b[d++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,d,m){b!=Array.prototype&&b!=Object.prototype&&(b[d]=m.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(b,d){this.$jscomp$symbol$id_=b;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:d})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function b(m){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(m||"")+"_"+d++,m)}var d=0;return b}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.asyncIterator;b||(b=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};
(function(b,d){"object"===typeof exports&&"object"===typeof module?module.exports=d():"function"===typeof define&&define.amd?define("regions",[],d):"object"===typeof exports?exports.regions=d():(b.WaveSurfer=b.WaveSurfer||{},b.WaveSurfer.regions=d())})(window,function(){return function(b){function d(k){if(m[k])return m[k].exports;var f=m[k]={i:k,l:!1,exports:{}};b[k].call(f.exports,f,f.exports,d);f.l=!0;return f.exports}var m={};d.m=b;d.c=m;d.d=function(b,f,m){d.o(b,f)||Object.defineProperty(b,f,
{enumerable:!0,get:m})};d.r=function(b){$jscomp.initSymbol();$jscomp.initSymbol();"undefined"!==typeof Symbol&&Symbol.toStringTag&&($jscomp.initSymbol(),Object.defineProperty(b,Symbol.toStringTag,{value:"Module"}));Object.defineProperty(b,"__esModule",{value:!0})};d.t=function(b,f){f&1&&(b=d(b));if(f&8||f&4&&"object"===typeof b&&b&&b.__esModule)return b;var k=Object.create(null);d.r(k);Object.defineProperty(k,"default",{enumerable:!0,value:b});if(f&2&&"string"!=typeof b)for(var v in b)d.d(k,v,function(a){return b[a]}.bind(null,
v));return k};d.n=function(b){var f=b&&b.__esModule?function(){return b["default"]}:function(){return b};d.d(f,"a",f);return f};d.o=function(b,d){return Object.prototype.hasOwnProperty.call(b,d)};d.p="localhost:8080/dist/plugin/";return d(d.s="./src/plugin/regions.js")}({"./src/plugin/regions.js":function(b,d,m){function k(b,a){if(!(b instanceof a))throw new TypeError("Cannot call a class as a function");}Object.defineProperty(d,"__esModule",{value:!0});var f=function(){function b(a,c){for(var b=
0;b<c.length;b++){var d=c[b];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(a,c,p){c&&b(a.prototype,c);p&&b(a,p);return a}}(),B=function(){function b(a,c){var p=this;k(this,b);this.wavesurfer=c;this.wrapper=c.drawer.wrapper;this.util=c.util;this.style=this.util.style;this.id=null==a.id?c.util.getId():a.id;this.start=Number(a.start)||0;this.end=null==a.end?this.start+4/this.wrapper.scrollWidth*this.wavesurfer.getDuration():
Number(a.end);this.resize=void 0===a.resize?!0:!!a.resize;this.drag=void 0===a.drag?!0:!!a.drag;this.loop=!!a.loop;this.color=a.color||"rgba(30, 30, 162, 0.51)";this.data=a.data||{};this.attributes=a.attributes||{};this.direction=a.direction||2;this.maxLength=a.maxLength;this.minLength=a.minLength;this._onRedraw=function(){return p.updateRender()};this.scroll=!1!==a.scroll&&c.params.scrollParent;this.scrollSpeed=a.scrollSpeed||1;this.scrollThreshold=a.scrollThreshold||28;this.bindInOut();this.render();
this.wavesurfer.on("zoom",this._onRedraw);this.wavesurfer.on("redraw",this._onRedraw);this.wavesurfer.fireEvent("region-created",this)}f(b,[{key:"update",value:function(a){null!=a.start&&(this.start=Number(a.start));null!=a.end&&(this.end=Number(a.end));null!=a.loop&&(this.loop=!!a.loop);null!=a.color&&(this.color=a.color);null!=a.data&&(this.data=a.data);null!=a.resize&&(this.resize=!!a.resize);null!=a.drag&&(this.drag=!!a.drag);null!=a.maxLength&&(this.maxLength=Number(a.maxLength));null!=a.minLength&&
(this.minLength=Number(a.minLength));null!=a.attributes&&(this.attributes=a.attributes);this.updateRender();this.fireEvent("update");this.wavesurfer.fireEvent("region-updated",this)}},{key:"remove",value:function(){this.element&&(this.wrapper.removeChild(this.element),this.element=null,this.fireEvent("remove"),this.wavesurfer.un("zoom",this._onRedraw),this.wavesurfer.un("redraw",this._onRedraw),this.wavesurfer.fireEvent("region-removed",this))}},{key:"play",value:function(){this.wavesurfer.play(this.start,
this.end);this.fireEvent("play");this.wavesurfer.fireEvent("region-play",this)}},{key:"playLoop",value:function(){var a=this;this.play();this.once("out",function(){return a.playLoop()})}},{key:"render",value:function(){var a=document.createElement("region");a.className="wavesurfer-region";a.title=this.formatTime(this.start,this.end);a.setAttribute("data-id",this.id);for(var c in this.attributes)a.setAttribute("data-region-"+c,this.attributes[c]);this.style(a,{position:"absolute",zIndex:2,height:"100%",
top:"0px"});if(this.resize){c=a.appendChild(document.createElement("handle"));var b=a.appendChild(document.createElement("handle"));c.className="wavesurfer-handle wavesurfer-handle-start";b.className="wavesurfer-handle wavesurfer-handle-end";var d={cursor:"col-resize",position:"absolute",left:"0px",top:"0px",width:"1%",maxWidth:"4px",height:"100%"};this.style(c,d);this.style(b,d);this.style(b,{left:"100%"})}this.element=this.wrapper.appendChild(a);this.updateRender();this.bindEvents(a)}},{key:"formatTime",
value:function(a,c){return(a==c?[a]:[a,c]).map(function(a){return[Math.floor(a%3600/60),("00"+Math.floor(a%60)).slice(-2)].join(":")}).join("-")}},{key:"getWidth",value:function(){return this.wavesurfer.drawer.width/this.wavesurfer.params.pixelRatio}},{key:"updateRender",value:function(){var a=this.wavesurfer.getDuration(),c=this.getWidth();0>this.start&&(this.start=0,this.end-=this.start);this.end>a&&(this.end=a,this.start=a-(this.end-this.start));null!=this.minLength&&(this.end=Math.max(this.start+
this.minLength,this.end));null!=this.maxLength&&(this.end=Math.min(this.start+this.maxLength,this.end));if(null!=this.element){var b=this.start/a*c;a=this.end/a*c-b;this.style(this.element,{left:this.wavesurfer.UnzoomifyPixelValue(b)+"px",width:a*this.wavesurfer.ZoomFactor+"px",cursor:this.drag?"move":"default"});for(var d in this.attributes)this.element.setAttribute("data-region-"+d,this.attributes[d]);this.element.title=this.formatTime(this.start,this.end)}}},{key:"bindInOut",value:function(){var a=
this;this.firedOut=this.firedIn=!1;var c=function(c){!a.firedOut&&a.firedIn&&(a.start>=Math.round(100*c)/100||a.end<=Math.round(100*c)/100)&&(a.firedOut=!0,a.firedIn=!1,a.fireEvent("out"),a.wavesurfer.fireEvent("region-out",a));!a.firedIn&&a.start<=c&&a.end>c&&(a.firedIn=!0,a.firedOut=!1,a.fireEvent("in"),a.wavesurfer.fireEvent("region-in",a))};this.wavesurfer.backend.on("audioprocess",c);this.on("remove",function(){a.wavesurfer.backend.un("audioprocess",c)});this.on("out",function(){a.loop?a.wavesurfer.play(a.start):
(a.wavesurfer.seekTo(a.start/a.wavesurfer.getDuration()),a.wavesurfer.stop())})}},{key:"bindEvents",value:function(){var a=this;this.element.addEventListener("mouseenter",function(c){a.fireEvent("mouseenter",c);a.wavesurfer.fireEvent("region-mouseenter",a,c)});this.element.addEventListener("mouseleave",function(c){a.fireEvent("mouseleave",c);a.wavesurfer.fireEvent("region-mouseleave",a,c)});this.element.addEventListener("click",function(c){c.preventDefault();a.fireEvent("click",c);a.wavesurfer.fireEvent("region-click",
a,c)});this.element.addEventListener("dblclick",function(c){c.stopPropagation();c.preventDefault();a.fireEvent("dblclick",c);a.wavesurfer.fireEvent("region-dblclick",a,c)});(this.drag||this.resize)&&function(){var c=a.wavesurfer.getDuration(),b=a.scrollSpeed,d=a.scrollThreshold,f=void 0,m=void 0,n=void 0,l=void 0,h=!1,r=void 0,k=void 0,v=function C(d,p){if(r&&(n||l)){var g=b,e=a.wavesurfer.drawer.wrapper.getBoundingClientRect();-1===p?(e=Math.abs(e.left-d.clientX)-10,0<e&&(g*=e/2)):1===p&&(e=Math.abs(d.clientX-
e.right)-10,0<e&&(g*=e/2));g=g*r/a.wavesurfer.getDuration();a.wavesurfer.LeftProgress+=g;0>a.wavesurfer.LeftProgress?a.wavesurfer.LeftProgress=0:a.wavesurfer.LeftProgress+a.wavesurfer.VisibleDuration>a.wavesurfer.getDuration()&&(a.wavesurfer.LeftProgress=a.wavesurfer.getDuration()-a.wavesurfer.VisibleDuration);a.wavesurfer.ForceDraw();g=a.wavesurfer.ZoomifyValue(a.wavesurfer.drawer.handleEvent(d))*c;e=g-f;f=g;n?a.onDrag(e):a.onResize(e,l);a.wavesurfer.fireEvent("DidZoom");window.requestAnimationFrame(function(){C(d,
p)})}},w=function(b){if(!(b.touches&&1<b.touches.length)&&3!==b.which){m=b.targetTouches?b.targetTouches[0].identifier:null;a.wavesurfer.Interacting|=1;b.stopPropagation();var d=new Event("killCTX",{bubbles:!0});document.body.dispatchEvent(d);f=a.wavesurfer.ZoomifyValue(a.wavesurfer.drawer.handleEvent(b,!0))*c;k=a.wrapper.getBoundingClientRect();"handle"==b.target.tagName.toLowerCase()?b.target.classList.contains("wavesurfer-handle-start")?l="start":b.target.classList.contains("wavesurfer-handle-end")&&
(l="end"):PKAudioEditor.ui.KeyHandler.keyMap[16]?2===a.direction?(l="end",a.update({start:a.start,end:f})):(l="start",a.update({start:f,end:a.end})):(n=!0,l=!1)}},t=function(c){if(!(c.touches&&1<c.touches.length)&&3!==c.which){a.wavesurfer.Interacting&=-2;if(n||l)n=!1,r=null,l=!1;h&&(h=!1,a.util.preventClick(),a.fireEvent("update-end",c),a.wavesurfer.fireEvent("region-update-end",a,c))}},q=function(b){if(!(b.touches&&1<b.touches.length||3===b.which||b.targetTouches&&b.targetTouches[0].identifier!=
m)&&(n||l)){var p=f,z=a.wavesurfer.ZoomifyValue(a.wavesurfer.drawer.handleEvent(b))*c,g=z-f;f=z;a.drag&&n&&(h=h||!!g,a.onDrag(g));a.resize&&l&&(h=h||!!g,l=a.onResize(g,l));if(1<a.wavesurfer.ZoomFactor){if(n){g=a.element.getBoundingClientRect();var e=g.left-k.left;z<p&&0<=e?r=-1:z>p&&e+g.width<=k.right&&(r=1);if(-1===r&&e>d||1===r&&e+g.width<k.right-d)r=null}else p=b.clientX-k.left,r=p<=d?-1:p>=k.right-k.left-d?1:null;r&&v(b,r)}}};a.element.addEventListener("mousedown",w);a.element.addEventListener("touchstart",
w);a.wrapper.addEventListener("mousemove",q);a.wrapper.addEventListener("touchmove",q);document.body.addEventListener("mouseup",t);document.body.addEventListener("touchend",t);a.on("remove",function(){document.body.removeEventListener("mouseup",t);document.body.removeEventListener("touchend",t);a.wrapper.removeEventListener("mousemove",q);a.wrapper.removeEventListener("touchmove",q);document.body.removeEventListener("pointerup",t);a.wrapper.removeEventListener("pointermove",q)});a.wavesurfer.on("destroy",
function(){document.body.removeEventListener("pointerup",t);document.body.removeEventListener("mouseup",t);document.body.removeEventListener("touchend",t)})}()}},{key:"onDrag",value:function(a){var c=this.wavesurfer.getDuration();this.end+a>c||0>this.start+a||this.update({start:this.start+a,end:this.end+a})}},{key:"onResize",value:function(a,c){"start"==c?this.start+a>this.end?(c="end",this.update({start:this.end,end:this.start+a})):this.update({start:Math.min(this.start+a,this.end),end:Math.max(this.start+
a,this.end)}):this.start>this.end+a?(c="start",this.update({start:this.start+a,end:this.start})):this.update({start:Math.min(this.end+a,this.start),end:Math.max(this.end+a,this.start)});return c}}]);return b}();m=function(){function b(a,c){var d=this;k(this,b);this.params=a;this.wavesurfer=c;this.util=c.util;Object.getOwnPropertyNames(this.util.Observer.prototype).forEach(function(a){B.prototype[a]=d.util.Observer.prototype[a]});this.wavesurfer.Region=B;this.list={};this._onReady=function(){d.wrapper=
d.wavesurfer.drawer.wrapper;d.params.regions&&d.params.regions.forEach(function(a){d.add(a)});d.params.dragSelection&&(d.disableDragSelection(),d.enableDragSelection(d.params))}}f(b,null,[{key:"create",value:function(a){return{name:"regions",deferInit:a&&a.deferInit?a.deferInit:!1,params:a,staticProps:{initRegions:function(){console.warn('Deprecated initRegions! Use wavesurfer.initPlugins("regions") instead!');this.initPlugin("regions")},addRegion:function(a){this.initialisedPluginList.regions||this.initPlugin("regions");
return this.regions.add(a)},clearRegions:function(){this.regions&&this.regions.clear()},enableDragSelection:function(a){this.initialisedPluginList.regions||this.initPlugin("regions");this.regions.enableDragSelection(a)},disableDragSelection:function(){this.regions.disableDragSelection()}},instance:b}}}]);f(b,[{key:"init",value:function(){this.wavesurfer.isReady&&this._onReady();this.wavesurfer.on("ready",this._onReady)}},{key:"destroy",value:function(){this.wavesurfer.un("ready",this._onReady);this.disableDragSelection();
this.clear()}},{key:"add",value:function(a){var c=this;this.list[0]&&this.clear();var b=new this.wavesurfer.Region(a,this.wavesurfer);this.list[0]=b;b.on("remove",function(){delete c.list[0]});"t"===a.id&&this.wavesurfer.fireEvent("region-update-end",b,null);return b}},{key:"clear",value:function(){var a=this;Object.keys(this.list).forEach(function(c){a.list[c].remove()})}},{key:"enableDragSelection",value:function(a){var c=this,b=a.slop||2,d=a.scrollSpeed||1,f=a.scrollThreshold||28,k=void 0,n=this.wavesurfer.getDuration(),
l=void 0,h=void 0,m=void 0,v=0,x=void 0,w=void 0,t=function D(a,b){if(h&&x){var g=d,e=c.wavesurfer.drawer.wrapper.getBoundingClientRect();-1===b?(e=Math.abs(e.left-a.clientX)-10,0<e&&(g*=e/2)):1===b&&(e=Math.abs(a.clientX-e.right)-10,0<e&&(g*=e/2));g=g*x/c.wavesurfer.getDuration();c.wavesurfer.LeftProgress+=g;0>c.wavesurfer.LeftProgress?c.wavesurfer.LeftProgress=0:c.wavesurfer.LeftProgress+c.wavesurfer.VisibleDuration>c.wavesurfer.getDuration()&&(c.wavesurfer.LeftProgress=c.wavesurfer.getDuration()-
c.wavesurfer.VisibleDuration);c.wavesurfer.ForceDraw();e=c.wavesurfer.ZoomifyValue(c.wavesurfer.drawer.handleEvent(a));h.update({start:Math.min(e*n,l*n),end:Math.max(e*n,l*n)});c.wavesurfer.fireEvent("DidZoom");0<Math.abs(g)&&window.requestAnimationFrame(function(){D(a,b)})}},q=null,y=function(a){q=null;if(a.touches&&(a.preventDefault(),1<a.touches.length))return;if(3===a.which)q={x:a.pageX,y:a.pageY};else if(c.wavesurfer.Interacting|=1,n=c.wavesurfer.getDuration(),m=a.targetTouches?a.targetTouches[0].identifier:
null,w=c.wrapper.getBoundingClientRect(),k=!0,l=c.wavesurfer.ZoomifyValue(c.wavesurfer.drawer.handleEvent(a,!0)),x=h=null,PKAudioEditor.ui.KeyHandler.keyMap[16]){var b=c.wavesurfer.ActiveMarker;a.stopPropagation();a.preventDefault();h=c.wavesurfer.regions.list[0];var d=2,g=c.wavesurfer.getDuration();a=c.wavesurfer.drawer.handleEvent(a);a=c.wavesurfer.ZoomifyValue(a);a<b&&(h&&h.start?(b=a,a=h.end/g):(d=b,b=a,a=d),d=1);h?(h.update({start:b*g,end:a*g}),h.direction=d,l=1===d?a:b):(c.wavesurfer.regions.add({start:b*
g,end:a*g,id:"t",direction:d}),h=c.wavesurfer.regions.list[0],h.direction=d,l=1===d?a:b,setTimeout(function(){PKAudioEditor.fireEvent("RequestSeekTo",b)},20))}};this.wrapper.addEventListener("mousedown",y);this.wrapper.addEventListener("touchstart",y);this.on("disable-drag-selection",function(){c.wrapper.removeEventListener("touchstart",y);c.wrapper.removeEventListener("mousedown",y);c.wrapper.removeEventListener("pointerdown",y)});var u=function(a){if(!(a.touches&&1<a.touches.length))if(3===a.which){if(q){if(3>
Math.abs(q.x-a.pageX)&&7>Math.abs(q.y-a.pageY)){var b=document.createEvent("Event");b.initEvent("pk_ctxmn",!0,!0);b.pageX=a.pageX;b.pageY=a.pageY;a.target.dispatchEvent(b)}q=null}}else c.wavesurfer.Interacting&=-2,k=!1,v=0,x=null,h&&(c.util.preventClick(),h.fireEvent("update-end",a),c.wavesurfer.fireEvent("region-update-end",h,a)),h=null};this.wrapper.addEventListener("mouseup",u);this.wrapper.addEventListener("touchend",u);document.body.addEventListener("mouseup",u);document.body.addEventListener("touchend",
u);this.on("disable-drag-selection",function(){document.body.removeEventListener("mouseup",u);document.body.removeEventListener("touchend",u);c.wrapper.removeEventListener("touchend",u);c.wrapper.removeEventListener("mouseup",u)});var A=function(d){if(k&&3!==d.which&&!(++v<=b||d.touches&&1<d.touches.length||d.targetTouches&&d.targetTouches[0].identifier!=m)){h||(h=c.add(a||{}));var e=c.wavesurfer.ZoomifyValue(c.wavesurfer.drawer.handleEvent(d));h.update({start:Math.min(e*n,l*n),end:Math.max(e*n,l*
n)});1<c.wavesurfer.ZoomFactor&&(e=d.clientX-w.left,(x=e<=f?-1:e>=w.right-w.left-f?1:null)&&t(d,x))}};this.wrapper.addEventListener("mousemove",A);this.wrapper.addEventListener("touchmove",A);this.on("disable-drag-selection",function(){c.wrapper.removeEventListener("touchmove",A);c.wrapper.removeEventListener("mousemove",A)})}},{key:"disableDragSelection",value:function(){this.fireEvent("disable-drag-selection")}},{key:"getCurrentRegion",value:function(){var a=this,b=this.wavesurfer.getCurrentTime(),
d=null;Object.keys(this.list).forEach(function(c){c=a.list[c];c.start<=b&&c.end>=b&&(!d||c.end-c.start<d.end-d.start)&&(d=c)});return d}}]);return b}();d["default"]=m;b.exports=d["default"]}})});